generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model customers {
  customer_id      BigInt     @id @default(autoincrement())
  customer_name    String
  customer_address String?
  invoices         invoices[]

  @@unique([customer_name, customer_address])
}

model invoice_line_items {
  line_item_id  BigInt   @id @default(autoincrement())
  invoice_id    BigInt
  line_no       Int?
  description   String?
  quantity      Decimal? @db.Decimal(18, 4)
  unit_price    Decimal? @db.Decimal(18, 4)
  total_price   Decimal? @db.Decimal(18, 4)
  sachkonto     String?
  bu_schluessel String?
  vat_rate      Decimal? @db.Decimal(9, 4)
  vat_amount    Decimal? @db.Decimal(18, 4)
  invoices      invoices @relation(fields: [invoice_id], references: [invoice_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([invoice_id], map: "idx_items_invoice")
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model invoices {
  invoice_id         BigInt               @id @default(autoincrement())
  invoice_number     String
  invoice_date       DateTime?            @db.Date
  delivery_date      DateTime?            @db.Date
  document_type      String
  currency_symbol    String?
  subtotal           Decimal?             @db.Decimal(18, 2)
  total_tax          Decimal?             @db.Decimal(18, 2)
  invoice_total      Decimal?             @db.Decimal(18, 2)
  vendor_id          BigInt
  customer_id        BigInt?
  invoice_line_items invoice_line_items[]
  customers          customers?           @relation(fields: [customer_id], references: [customer_id], onUpdate: NoAction)
  vendors            vendors              @relation(fields: [vendor_id], references: [vendor_id], onUpdate: NoAction)
  payments           payments[]

  @@unique([invoice_number, vendor_id])
  @@index([customer_id], map: "idx_invoices_customer")
  @@index([vendor_id], map: "idx_invoices_vendor")
}

model payments {
  payment_id          BigInt    @id @default(autoincrement())
  invoice_id          BigInt
  due_date            DateTime? @db.Date
  payment_terms       String?
  bank_account_number String?
  bic                 String?
  account_name        String?
  net_days            Int?
  discount_percentage Decimal?  @db.Decimal(5, 2)
  discount_days       Int?
  discount_due_date   DateTime? @db.Date
  discounted_total    Decimal?  @db.Decimal(18, 2)
  invoices            invoices  @relation(fields: [invoice_id], references: [invoice_id], onDelete: Cascade, onUpdate: NoAction)

  @@index([invoice_id], map: "idx_payments_invoice")
}

model vendors {
  vendor_id      BigInt     @id @default(autoincrement())
  vendor_name    String
  vendor_address String?
  vendor_tax_id  String?
  invoices       invoices[]

  @@unique([vendor_name, vendor_tax_id])
}
